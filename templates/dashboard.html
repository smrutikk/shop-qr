<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>

<title>{{ shop.name }} Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Inter', sans-serif; }
</style>
</head>

<body class="min-h-screen bg-gradient-to-br from-indigo-200 via-indigo-100 to-cyan-200">

<!-- HEADER -->
<header class="bg-white/80 backdrop-blur border-b">
  <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
    <h1 class="text-xl font-bold text-indigo-700">
      üñ®Ô∏è {{ shop.name }} Dashboard
    </h1>

    <a href="/logout"
       class="text-sm bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
      Logout
    </a>
  </div>
</header>

<!-- CONTENT -->
<main class="max-w-6xl mx-auto p-6">
  <div class="bg-white rounded-2xl shadow-lg border p-6">

    <h2 class="text-lg font-semibold mb-5 text-gray-700">
      üìÑ Print Requests
    </h2>

    {% if requests|length == 0 %}
      <div class="text-center text-gray-500 py-14">
        <div class="text-4xl mb-2">üì≠</div>
        No print requests yet
      </div>
    {% else %}

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm border rounded-lg overflow-hidden">

        <thead class="bg-indigo-50 text-indigo-700">
          <tr>
            <th class="px-4 py-3 border">Request ID</th>
            <th class="px-4 py-3 border">Status</th>
            <th class="px-4 py-3 border">Time</th>
            <th class="px-4 py-3 border">Action</th>
          </tr>
        </thead>

        <tbody class="bg-white">
        {% for req in requests %}
          <tr class="hover:bg-indigo-50/40 transition even:bg-gray-50">

            <td class="px-4 py-3 border font-medium text-gray-700">
              #{{ req.id }}
            </td>

            <td class="px-4 py-3 border">
              {% if req.status == 'Pending' %}
                <span class="px-3 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800 font-medium">
                  ‚è≥ Pending
                </span>
              {% elif req.status == 'In Progress' %}
                <span class="px-3 py-1 text-xs rounded-full bg-blue-100 text-blue-800 font-medium">
                  üñ®Ô∏è In Progress
                </span>
              {% else %}
                <span class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-800 font-medium">
                  ‚úÖ Completed
                </span>
              {% endif %}
            </td>

            <td class="px-4 py-3 border text-xs text-gray-500">
              {{ req.ist_time.strftime('%d %b %Y, %I:%M %p') }}
            </td>

            <td class="px-4 py-3 border text-center">
              {% if req.status == 'Pending' %}
                <button
                  onclick="openAndDisable(this, '{{ req.id }}')"
                  class="bg-indigo-600 text-white px-3 py-1.5 rounded-md text-xs hover:bg-indigo-700 transition shadow-sm">
                  üí¨ Open WhatsApp
                </button>

              {% elif req.status == 'In Progress' %}
                <a href="/mark_completed/{{ req.id }}"
                   class="bg-green-600 text-white px-3 py-1.5 rounded-md text-xs hover:bg-green-700 transition shadow-sm">
                  ‚úÖ Mark Done
                </a>
              {% else %}
                <span class="text-gray-400 text-xs">Done</span>
              {% endif %}
            </td>

          </tr>
        {% endfor %}
        </tbody>

      </table>
    </div>

    {% endif %}
  </div>
</main>

<script>
  setInterval(() => {
    window.location.reload();
  }, 3000);

  function openAndDisable(btn, reqId) {
    btn.innerText = "Opening...";
    btn.classList.add("opacity-50");
    btn.disabled = true;

    window.open(`/open_whatsapp/${reqId}`, "_blank");

    setTimeout(() => {
      window.location.reload();
    }, 1500);
  }
</script>

</body>
</html>
